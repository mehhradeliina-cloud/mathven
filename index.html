<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>????????? ????? — ????????? (Venn)</title>
  <style>
    :root{
      --bg:#ffffff;
      --pink:#ffd6e8; /* ????? ?? ??? */
      --teal:#bff7ff; /* ??? ?????? */
      --lemon:#fff9c4; /* ??? ?????? ?? ??? */
      --orange:#ffd8b5; /* ?????? ?? ??? */
      --lilac:#efe6ff; /* ???? */
      --lightpurple:#e7d3ff; /* ???? ?? ??? */
      --font:#000000; /* ???? */
      --card:#f8f8f9;
      --radius:10px;
    }
    *{box-sizing:border-box;font-family:Tahoma, Arial, sans-serif;color:var(--font)}
    body{background:var(--bg);padding:18px}
    h1{font-size:20px;margin-bottom:8px}
    .container{max-width:980px;margin:0 auto}
    .card{background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:12px}
    label.bold{font-weight:700;display:block;margin-bottom:6px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    input[type=number]{padding:8px;border-radius:8px;border:1px solid #ddd;width:120px}
    select{padding:8px;border-radius:8px;border:1px solid #ddd}
    button{padding:9px 12px;border-radius:10px;border:0;background:var(--teal);cursor:pointer}
    .sets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
    .set-box{padding:10px;border-radius:10px}
    .set-box input[type=number]{width:100%}
    .hint{font-size:13px;color:#333}
    .canvas-wrap{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
    canvas{background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    .result-list{min-height:40px;padding:8px;border-radius:8px;background:#fff}
    /* set colors for boxes (rotate through them) */
    .c1{background:var(--pink)}
    .c2{background:var(--teal)}
    .c3{background:var(--lemon)}
    .c4{background:var(--orange)}
    .c5{background:var(--lilac)}
    .c6{background:var(--lightpurple)}
    .small{font-size:13px}
    .note{margin-top:8px;font-size:13px}
    .danger{color:#b00020}
  </style>
</head>
<body>
  <div class="container">
    <h1>????????? ????? — ????????? (Venn)</h1>

    <div class="card">
      <label class="bold">????????? ?????? ????? ?????????? ??? ?? ?????? ???? <span class="small">(????? 2 ? ?????? 10 ??????)</span></label>
      <div class="row">
        <input id="numSets" type="number" min="2" max="10" value="2" />
        <button id="createSetsBtn">????? ???????</button>
      </div>
      <p class="note">(?????: ??? ????????? ?? A ?? J ????? ???? ????? ????? ?? 10 ???? ????.)</p>
    </div>

    <div id="setsContainer" class="sets-grid"></div>

    <div class="card">
      <label class="bold">?????? ?? ?????? ?? A ?? J <span class="small">(??? ?? ?????? ?????? ???)</span></label>
      <div class="row">
        <select id="selA"></select>
        <select id="selB"></select>
      </div>
    </div>

    <div class="card">
      <label class="bold">?????? ??? ????? ??? ?? ?????? <span class="small">(??? ?? ??????? ??? ?? ?????? ????)</span></label>
      <div class="row">
        <select id="operation">
          <option value="union">?????? (A ? B)</option>
          <option value="intersection">?????? (A n B)</option>
          <option value="difference">????? (A - B)</option>
        </select>
        <button id="drawBtn">????? ?????? ??</button>
      </div>
    </div>

    <div class="card canvas-wrap">
      <div>
        <label class="bold">?????? ?? (????????) <span class="small">(????? ??????? ??? ?????? ?????????)</span></label>
        <canvas id="vennCanvas" width="600" height="360"></canvas>
      </div>
      <div style="flex:1">
        <label class="bold">????? ? ????? ???? <span class="small">(????? ???? ??????)</span></label>
        <div id="resultArea" class="result-list"></div>
        <p class="note">(?????: ???? ?? ?????? ????? ????? ???? ?? ???? ???? ??? ??? ???? "????? ??????? ????" ???? ???? ?? ????????? ???? ???? ???? ????? ????.)</p>
      </div>
    </div>

  </div>

  <script>
    const names = ['A','B','C','D','E','F','G','H','I','J'];
    const colorClasses = ['c1','c2','c3','c4','c5','c6'];
    const colorFills = ['#ffd6e8','#bff7ff','#fff9b0','#ffd8b5','#efe6ff','#e7d3ff'];

    const setsContainer = document.getElementById('setsContainer');
    const numSetsInput = document.getElementById('numSets');
    const createSetsBtn = document.getElementById('createSetsBtn');
    const selA = document.getElementById('selA');
    const selB = document.getElementById('selB');
    const operation = document.getElementById('operation');
    const drawBtn = document.getElementById('drawBtn');
    const resultArea = document.getElementById('resultArea');
    const canvas = document.getElementById('vennCanvas');
    const ctx = canvas.getContext('2d');

    let sets = {}; // { 'A':[nums], ... }

    function createSets(){
      const n = Math.max(2, Math.min(10, parseInt(numSetsInput.value)||2));
      setsContainer.innerHTML = '';
      sets = {};
      for(let i=0;i<n;i++){
        const key = names[i];
        sets[key] = [];
        const box = document.createElement('div');
        box.className = 'set-box ' + colorClasses[i % colorClasses.length];
        box.style.padding = '12px';
        box.innerHTML = `
          <label class="bold">?????? ${key} <span class="small">(????? ???? ??? ??? ?? ???? ????)</span></label>
          <div class="row">
            <input type="number" min="0" value="0" class="cnt" data-set="${key}" />
            <button class="makeFields" data-set="${key}">????? ??????? ????</button>
          </div>
          <div class="members" data-set="${key}" style="margin-top:8px"></div>
        `;
        setsContainer.appendChild(box);
      }
      refreshSelectors();
      attachSetEvents();
    }

    function refreshSelectors(){
      selA.innerHTML='';selB.innerHTML='';
      Object.keys(sets).forEach(k=>{
        const o1 = document.createElement('option'); o1.value=k; o1.textContent=k;
        const o2 = document.createElement('option'); o2.value=k; o2.textContent=k;
        selA.appendChild(o1); selB.appendChild(o2);
      });
      // ensure different defaults
      if(selA.options.length>1) selB.selectedIndex = 1;
    }

    function attachSetEvents(){
      document.querySelectorAll('.makeFields').forEach(btn=>{
        btn.onclick = (e)=>{
          const setKey = btn.getAttribute('data-set');
          const parent = btn.parentElement;
          const cntInput = parent.querySelector('.cnt');
          const cnt = Math.max(0, parseInt(cntInput.value)||0);
          const membersDiv = document.querySelector('.members[data-set="'+setKey+'"]');
          membersDiv.innerHTML='';
          for(let i=0;i<cnt;i++){
            const inp = document.createElement('input');
            inp.type='number'; inp.className='member'; inp.placeholder = '??? '+(i+1);
            inp.style.marginBottom='6px'; inp.style.width='100%';
            membersDiv.appendChild(inp);
          }
        };
      });
    }

    createSetsBtn.addEventListener('click',()=>{
      createSets();
    });

    // initial
    createSets();

    function readSetsFromUI(){
      Object.keys(sets).forEach(k=>{
        const membersDiv = document.querySelector('.members[data-set="'+k+'"]');
        const vals = [];
        if(membersDiv){
          membersDiv.querySelectorAll('input.member').forEach(inp=>{
            const v = inp.value;
            if(v!=='' && !isNaN(Number(v))){
              vals.push(Number(v));
            }
          });
        }
        // dedupe and sort
        sets[k] = Array.from(new Set(vals)).sort((a,b)=>a-b);
      });
    }

    function computeResult(aSet,bSet,op){
      const A = new Set(sets[aSet]||[]);
      const B = new Set(sets[bSet]||[]);
      let res = [];
      if(op==='union'){
        res = Array.from(new Set([...A,...B])).sort((x,y)=>x-y);
      } else if(op==='intersection'){
        res = Array.from([...A].filter(x=>B.has(x))).sort((x,y)=>x-y);
      } else if(op==='difference'){
        res = Array.from([...A].filter(x=>!B.has(x))).sort((x,y)=>x-y);
      }
      return res;
    }

    function drawVenn(aSet,bSet,op){
      // canvas clear
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // positions
      const cx1 = 200, cy=180, r=120;
      const cx2 = 360;
      // base circles with low opacity
      // circle A
      ctx.globalCompositeOperation = 'source-over';
      ctx.beginPath(); ctx.arc(cx1,cy,r,0,Math.PI*2); ctx.closePath();
      ctx.fillStyle = colorFills[0]; ctx.globalAlpha = 0.65; ctx.fill();
      ctx.strokeStyle = '#00000022'; ctx.globalAlpha = 1; ctx.stroke();
      // circle B
      ctx.beginPath(); ctx.arc(cx2,cy,r,0,Math.PI*2); ctx.closePath();
      ctx.fillStyle = colorFills[1]; ctx.globalAlpha = 0.65; ctx.fill();
      ctx.strokeStyle = '#00000022'; ctx.globalAlpha = 1; ctx.stroke();

      // highlight according to operation using composite operations
      if(op==='union'){
        // draw both with stronger alpha
        ctx.globalCompositeOperation = 'source-over';
        ctx.beginPath(); ctx.arc(cx1,cy,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle = colorFills[0]; ctx.globalAlpha = 0.95; ctx.fill();
        ctx.beginPath(); ctx.arc(cx2,cy,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle = colorFills[1]; ctx.globalAlpha = 0.95; ctx.fill();
      } else if(op==='intersection'){
        // draw A, then keep only intersection by using destination-in
        // draw A opaque into offscreen, then composite
        // we'll use layering technique
        // draw A
        ctx.globalCompositeOperation = 'destination-over';
        // create intersection by drawing with 'source-in'
        // clear a temp area by using globalCompositeOperation tricks: simpler approach:
        // draw A with high alpha, then set composite to 'destination-in' and draw B to keep overlap only
        // Save
        ctx.save();
        // Create intersection: first draw A with full alpha to a new layer
        ctx.globalCompositeOperation = 'source-over';
        ctx.beginPath(); ctx.arc(cx1,cy,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle = colorFills[5]; ctx.globalAlpha = 0.0; ctx.fill();
        // Now use composite to keep only overlap area
        ctx.globalCompositeOperation = 'source-in';
        ctx.beginPath(); ctx.arc(cx2,cy,r,0,Math.PI*2); ctx.closePath(); ctx.fillStyle = colorFills[0]; ctx.globalAlpha = 0.6; ctx.fill();
        ctx.restore();
        // The above trick may not work cross-browser so do a more explicit method:
        // We'll draw intersection into an offscreen canvas and then draw it.
        try{
          const off = document.createElement('canvas'); off.width = canvas.width; off.height = canvas.height;
          const octx = off.getContext('2d');
          // draw A
          octx.beginPath(); octx.arc(cx1,cy,r,0,Math.PI*2); octx.closePath(); octx.fillStyle=colorFills[0]; octx.globalAlpha=0.95; octx.fill();
          // keep intersection by setting composite
          octx.globalCompositeOperation = 'destination-in';
          octx.beginPath(); octx.arc(cx2,cy,r,0,Math.PI*2); octx.closePath(); octx.fill();
          // draw result onto main
          ctx.drawImage(off,0,0);
        } catch(e){
          // fallback: overlay darker overlapping region roughly
          ctx.beginPath(); ctx.arc((cx1+cx2)/2,cy,70,0,Math.PI*2); ctx.closePath(); ctx.fillStyle='#cbbcff'; ctx.globalAlpha=0.6; ctx.fill();
        }
      } else if(op==='difference'){
        // A - B: draw A, then erase intersection with composite
        // draw A opaque to offscreen
        const off = document.createElement('canvas'); off.width = canvas.width; off.height = canvas.height;
        const octx = off.getContext('2d');
        // draw A
        octx.beginPath(); octx.arc(cx1,cy,r,0,Math.PI*2); octx.closePath(); octx.fillStyle=colorFills[0]; octx.globalAlpha=0.95; octx.fill();
        // erase where B is (destination-out)
        octx.globalCompositeOperation='destination-out';
        octx.beginPath(); octx.arc(cx2,cy,r,0,Math.PI*2); octx.closePath(); octx.fill();
        // draw off onto main
        ctx.drawImage(off,0,0);
      }

      // draw labels
      ctx.globalAlpha=1; ctx.fillStyle='#000'; ctx.font='bold 18px Tahoma'; ctx.fillText(aSet, cx1-6, cy- r - 15);
      ctx.fillText(bSet, cx2-6, cy - r - 15);

    }

    drawBtn.addEventListener('click',()=>{
      readSetsFromUI();
      const a = selA.value; const b = selB.value; const op = operation.value;
      if(!a || !b){ alert('?? ?????? ?????? ????????.'); return; }
      if(a===b){ alert('????? ?? ?????? ?????? ?????? ????.'); return; }
      const res = computeResult(a,b,op);
      // display result
      resultArea.innerHTML = '';
      const title = document.createElement('div'); title.className='small'; title.textContent = `??????? ?????? (${op==='union'?'??????':(op==='intersection'?'??????':'?????')}) ??? ${a} ? ${b}:`;
      resultArea.appendChild(title);
      const arrDiv = document.createElement('div'); arrDiv.style.marginTop='8px'; arrDiv.textContent = res.length?res.join(', '):'???? (??? ???)';
      resultArea.appendChild(arrDiv);
      drawVenn(a,b,op);
    });

  </script>
</body>
</html>
