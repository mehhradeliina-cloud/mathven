<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>آزمایشگاه ریاضی — مجموعه‌ها (Venn)</title>
  <style>
    :root{
      --bg:#ffffff;
      --light-pink:#ffd6e8; /* صورتی کم رنگ */
      --teal:#8fe3d0; /* آبی اسمانی */
      --lemon:#fff8bf; /* زرد لیمویی کم رنگ */
      --light-orange:#ffdcb3; /* نارنجی کم رنگ */
      --lilac:#f0d7ff; /* یاسی */
      --light-purple:#e6d3ff; /* بنفش کم رنگ */
      --black:#000000;
      --card-radius:12px;
      --gap:12px;
      --max-width:1000px;
    }
    body{
      font-family: Tahoma, system-ui, sans-serif;
      background:var(--bg);
      color:var(--black);
      padding:20px;
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:var(--max-width);
      gap:var(--gap);
      display:flex;
      flex-direction:column;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.9));
      border-radius:var(--card-radius);
      padding:14px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
    label{display:block;margin-bottom:6px}
    input[type=number], select{padding:8px;border-radius:8px;border:1px solid #ccc}
    .sets-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
    .set-card{padding:10px;border-radius:10px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
    .btn-primary{background:var(--teal);color:var(--black)}
    .btn-ghost{background:transparent;border:1px solid #ccc}
    .note{font-weight:bold}
    small.parenthesis{display:block;margin-top:8px;font-weight:bold}

    /* colors for set cards (A-J) cycling */
    .set-A{background:var(--light-pink)}
    .set-B{background:var(--teal)}
    .set-C{background:var(--lemon)}
    .set-D{background:var(--light-orange)}
    .set-E{background:var(--lilac)}
    .set-F{background:var(--light-purple)}
    .set-G{background:var(--light-pink)}
    .set-H{background:var(--teal)}
    .set-I{background:var(--lemon)}
    .set-J{background:var(--light-orange)}

    /* Venn area */
    .venn-wrap{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .venn-box{background:#fff;border-radius:12px;padding:12px;min-width:320px;flex:1}
    svg{width:100%;height:auto}
    .elements-list{max-height:140px;overflow:auto;padding:8px;border-radius:8px;background:#fff}
    .msg{color:#b00}

    @media(min-width:900px){
      .top-row{flex-direction:row}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="note">آزمایشگاه ریاضی — مجموعه‌ها (Venn)</h2>

    <div class="card">
      <div class="row top-row">
        <div style="flex:1">
          <label class="note">دانش آموز گرامی تعداد مجموعه های خود را انتخاب کنید</label>
          <input id="setsCount" type="number" min="10" max="10" value="10" />
          <small class="parenthesis">(تعداد مجموعه های مورد نظر خود را وارد کنید ، حداقل ده مجموعه — بین ۱۰ تا ۱۰)</small>
        </div>
        <div style="width:220px">
          <label class="note">دکمه ایجاد مجموعه‌ها</label>
          <div class="controls">
            <button id="createSets" class="btn btn-primary">ایجاد مجموعه‌ها</button>
            <button id="resetAll" class="btn btn-ghost">بازنشانی</button>
          </div>
          <small class="parenthesis">(بعد از وارد کردن تعداد، برای ساخت باکس‌ها این دکمه را بزنید)</small>
        </div>
      </div>
    </div>

    <div id="setsContainer" class="card">
      <!-- dynamically generated set boxes (A..J) -->
      <div id="setsGrid" class="sets-grid"></div>
      <small class="parenthesis">(برای هر مجموعه، عناصر عددی را با دکمه "افزودن" اضافه کنید; نوع ورودی number است)</small>
    </div>

    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label class="note">دو مجموعه مورد نظر را انتخاب کنید</label>
          <div class="controls">
            <select id="selectA"></select>
            <select id="selectB"></select>
          </div>
          <small class="parenthesis">(دانش آموز فقط میتواند دو تا از مجموعه های A تا J را انتخاب کند)</small>
        </div>
        <div style="width:320px">
          <label class="note">یکی از عمل های ریاضی زیر را انتخاب کنید</label>
          <select id="operation">
            <option value="union">اجتماع (A ∪ B)</option>
            <option value="intersection">اشتراک (A ∩ B)</option>
            <option value="difference">تفاضل (A \ B)</option>
          </select>
          <small class="parenthesis">(یکی از عمل های ریاضی زیر را انتخاب کنید)</small>
        </div>
      </div>
    </div>

    <div class="card venn-wrap">
      <div class="venn-box">
        <label class="note">نمایش گرافیکی وِن</label>
        <svg viewBox="0 0 500 260" id="vennSVG" aria-label="Venn diagram">
          <!-- circles: left = A, right = B -->
          <defs>
            <filter id="soft" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="1.2" />
            </filter>
          </defs>
          <g id="vennGroup">
            <circle id="circleA" cx="170" cy="130" r="90" fill="var(--light-pink)" fill-opacity="0.45" stroke="#000" stroke-opacity="0.1" filter="url(#soft)" />
            <circle id="circleB" cx="330" cy="130" r="90" fill="var(--teal)" fill-opacity="0.45" stroke="#000" stroke-opacity="0.1" filter="url(#soft)" />

            <!-- Highlight layers (transparent by default) -->
            <path id="onlyA" fill="var(--light-pink)" fill-opacity="0.65" stroke="#000" stroke-opacity="0.06"></path>
            <path id="onlyB" fill="var(--teal)" fill-opacity="0.65" stroke="#000" stroke-opacity="0.06"></path>
            <path id="bothAB" fill="#ffdf80" fill-opacity="0.85" stroke="#000" stroke-opacity="0.06"></path>

            <!-- labels -->
            <text x="110" y="50" font-size="20" font-weight="700">مجموعه A</text>
            <text x="360" y="50" font-size="20" font-weight="700">مجموعه B</text>
          </g>
        </svg>
        <small class="parenthesis">(در نمایش نمودار ون حتما از شکل دایره استفاده شده و نواحی برای هایلایت آماده‌اند)</small>
      </div>

      <div style="flex:0.8;min-width:260px">
        <div class="card">
          <label class="note">عناصر انتخاب‌شده از هر مجموعه</label>
          <div class="elements-list" id="elementsList">هیچ مجموعه‌ای انتخاب نشده است</div>
          <small class="parenthesis">(برای نمایش نتایج عملیات، نواحی مربوطه در نمودار هایلایت می‌شوند)</small>
        </div>

        <div class="card" style="margin-top:10px">
          <label class="note">عملیات را اجرا کنید</label>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="computeBtn" class="btn btn-primary">اجرای عمل</button>
            <button id="showAll" class="btn btn-ghost">نمایش تمامی عناصر هر مجموعه</button>
          </div>
          <div id="resultMsg" style="margin-top:8px"></div>
          <small class="parenthesis">(برای نمایش عمل اجتماع، اشتراک یا تفاضل از دکمه اجرا استفاده کنید)</small>
        </div>
      </div>
    </div>

    <div style="height:30px"></div>
    <footer style="text-align:center;color:#666;font-size:13px">کد ساخته شده: تنها یک فایل HTML — آماده آپلود در گیت‌هاب</footer>
  </div>

  <script>
    // Utility functions
    const letters = ['A','B','C','D','E','F','G','H','I','J'];

    function makeSetCard(name, index){
      const div = document.createElement('div');
      div.className = 'set-card set-' + name;
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>مجموعه ${name}</strong>
          <div>
            <button class="btn btn-ghost add-elem">افزودن</button>
            <button class="btn btn-ghost clear-elem">پاک کردن</button>
          </div>
        </div>
        <div style="margin-top:8px">
          <div class="elems" data-set="${name}"></div>
        </div>
        <div style="margin-top:8px;font-size:12px">عناصر: <span class="count">0</span></div>
      `;
      return div;
    }

    // Global state: sets -> Map name => array of numbers
    const sets = {};

    function createSets(n){
      const grid = document.getElementById('setsGrid');
      grid.innerHTML = '';
      setsMapClear();
      for(let i=0;i<n;i++){
        const name = letters[i];
        sets[name]=[];
        const card = makeSetCard(name, i);
        card.querySelector('.add-elem').addEventListener('click', ()=> addElementInput(card, name));
        card.querySelector('.clear-elem').addEventListener('click', ()=> clearSet(name, card));
        grid.appendChild(card);
      }
      populateSelectors();
    }

    function setsMapClear(){
      for(const k in sets) delete sets[k];
    }

    function addElementInput(card, setName){
      const container = card.querySelector('.elems');
      const row = document.createElement('div');
      row.style.display='flex';row.style.gap='6px';row.style.marginBottom='6px';
      const input = document.createElement('input');
      input.type='number'; input.placeholder='عدد'; input.style.flex='1';
      const btn = document.createElement('button'); btn.className='btn btn-primary'; btn.textContent='ذخیره';
      btn.addEventListener('click', ()=>{
        const v = input.value;
        if(v === '') return alert('لطفا یک عدد وارد کنید');
        const num = Number(v);
        if(Number.isNaN(num)) return alert('فرمت عددی صحیح نیست');
        sets[setName].push(num);
        input.value='';
        renderSetCard(setName);
      });
      row.appendChild(input); row.appendChild(btn);
      container.prepend(row);
    }

    function clearSet(name, card){
      if(!confirm(`آیا می‌خواهید عناصر مجموعه ${name} پاک شوند؟`)) return;
      sets[name]=[];
      renderSetCard(name);
    }

    function renderSetCard(name){
      const grid = document.getElementById('setsGrid');
      const cards = grid.querySelectorAll('.set-card');
      cards.forEach(card=>{
        const elems = card.querySelector('.elems');
        if(elems && elems.dataset.set === name){
          // remove existing list display (keep input rows)
          const inputs = Array.from(elems.querySelectorAll('div')).filter(d => d.querySelector('input'));
          elems.innerHTML='';
          inputs.forEach(i=> elems.appendChild(i));
          // add list of saved elements
          const saved = document.createElement('div');
          saved.style.marginTop='8px';
          saved.textContent = sets[name].join(', ') || '—';
          elems.appendChild(saved);
          const count = card.querySelector('.count');
          if(count) count.textContent = String(sets[name].length);
        }
      });
      populateSelectors();
    }

    function populateSelectors(){
      const selA = document.getElementById('selectA');
      const selB = document.getElementById('selectB');
      selA.innerHTML=''; selB.innerHTML='';
      Object.keys(sets).forEach(k=>{
        const o1 = document.createElement('option'); o1.value=k; o1.textContent='مجموعه ' + k;
        const o2 = o1.cloneNode(true);
        selA.appendChild(o1); selB.appendChild(o2);
      });
      // ensure different defaults
      if(selA.options.length>0){ selA.selectedIndex=0; selB.selectedIndex=Math.min(1,selB.options.length-1); }
      updateVennLabels();
    }

    function updateVennLabels(){
      const a = document.getElementById('selectA').value || 'A';
      const b = document.getElementById('selectB').value || 'B';
      const svg = document.getElementById('vennSVG');
      const texts = svg.querySelectorAll('text');
      if(texts[0]) texts[0].textContent = 'مجموعه ' + a;
      if(texts[1]) texts[1].textContent = 'مجموعه ' + b;
    }

    // SVG geometry helpers: construct paths for circle minus intersection and intersection
    function circlePath(cx,cy,r){
      return `M ${cx-r} ${cy} a ${r} ${r} 0 1 0 ${2*r} 0 a ${r} ${r} 0 1 0 ${-2*r} 0`;
    }

    // Use simple approach: draw full circles as paths and use clip rules for highlight paths using <clipPath> would be cleaner,
    // but for simplicity compute intersection region via SVG path for two equal circles.
    function updateVennVisual(){
      const Aname = document.getElementById('selectA').value;
      const Bname = document.getElementById('selectB').value;
      const op = document.getElementById('operation').value;
      const a = sets[Aname] || [];
      const b = sets[Bname] || [];

      const onlyA = document.getElementById('onlyA');
      const onlyB = document.getElementById('onlyB');
      const both = document.getElementById('bothAB');

      // circle params (must match SVG circles)
      const Ax=170, Ay=130, Ar=90;
      const Bx=330, By=130, Br=90;

      // simple geometric path building for left-only, right-only and overlap using arc-based clipping
      // We'll build using path for intersection of two equal circles centered at Ax,Ay and Bx,By
      const d_intersection = intersectionPath(Ax,Ay,Ar,Bx,By,Br);
      const d_circleA = circlePath(Ax,Ay,Ar);
      const d_circleB = circlePath(Bx,By,Br);

      if(op === 'union'){
        // highlight both circles entirely (union) — show bothA and bothB filled
        onlyA.setAttribute('d', d_circleA);
        onlyB.setAttribute('d', d_circleB);
        both.setAttribute('d', d_intersection);
        // set opacities so union looks bright: we'll show both circles with slightly different overlays
        onlyA.style.display='block'; onlyB.style.display='block'; both.style.display='block';
        onlyA.setAttribute('fill-opacity','0.45'); onlyB.setAttribute('fill-opacity','0.45'); both.setAttribute('fill-opacity','0.65');
      } else if(op === 'intersection'){
        // hide full circle fills; show only intersection highlighted
        onlyA.style.display='none'; onlyB.style.display='none'; both.style.display='block';
        both.setAttribute('d', d_intersection);
        both.setAttribute('fill','#ffdf80'); both.setAttribute('fill-opacity','0.85');
      } else if(op === 'difference'){
        // A \ B: highlight only part of A that is not in intersection
        const dAminus = subtractPath(d_circleA, d_intersection);
        onlyA.setAttribute('d', dAminus);
        onlyA.style.display='block'; onlyB.style.display='none'; both.style.display='none';
        onlyA.setAttribute('fill','#ffd6e8'); onlyA.setAttribute('fill-opacity','0.75');
      }

      // Update elements list and result message
      const elementsDiv = document.getElementById('elementsList');
      elementsDiv.innerHTML = '';
      const pA = document.createElement('div'); pA.innerHTML = `<strong>مجموعه ${Aname}:</strong> ${a.join(', ') || '—'}`;
      const pB = document.createElement('div'); pB.innerHTML = `<strong>مجموعه ${Bname}:</strong> ${b.join(', ') || '—'}`;
      elementsDiv.appendChild(pA); elementsDiv.appendChild(pB);

      // compute actual result set
      let result = [];
      if(op === 'union'){
        result = Array.from(new Set([...a,...b]));
      } else if(op === 'intersection'){
        result = a.filter(x => b.includes(x)).filter((v,i,arr)=>arr.indexOf(v)===i);
      } else if(op === 'difference'){
        result = a.filter(x => !b.includes(x));
      }
      const msg = document.getElementById('resultMsg');
      msg.innerHTML = `<strong>نتیجه:</strong> ${result.join(', ') || '∅'} `;
    }

    // Create an SVG path for intersection of two equal circles (approx analytic)
    function intersectionPath(x1,y1,r1,x2,y2,r2){
      // This function returns a path that represents the overlapping lens region of two circles.
      // Based on circle-circle intersection geometry. Works when circles intersect.
      const dx = x2-x1; const dy = y2-y1; const d = Math.hypot(dx,dy);
      if(d >= r1 + r2) return '';
      if(d <= Math.abs(r1 - r2)) return circlePath(x1,y1,r1); // one inside another

      const a = (r1*r1 - r2*r2 + d*d)/(2*d);
      const h = Math.sqrt(Math.max(0, r1*r1 - a*a));
      const xm = x1 + a * (dx) / d;
      const ym = y1 + a * (dy) / d;
      const xs1 = xm + h * (dy) / d;
      const ys1 = ym - h * (dx) / d;
      const xs2 = xm - h * (dy) / d;
      const ys2 = ym + h * (dx) / d;

      // path: move to first intersection, arc on circle2 to second intersection, arc on circle1 back
      const path = `M ${xs1} ${ys1} `+
                   `A ${r2} ${r2} 0 0 1 ${xs2} ${ys2} `+
                   `A ${r1} ${r1} 0 0 1 ${xs1} ${ys1} Z`;
      return path;
    }

    // Subtract path (naive): we return circle path but visually it will overlap; better result for highlight: use intersection clipping approach,
    // but for our simple highlighting we will mask intersection by drawing intersection on top; here we simply return circle path and hide overlap by covering later.
    function subtractPath(circlePathStr, interPathStr){
      // To show only A\B we will draw full A path; intersection is drawn on top (hidden) by the other overlays, so using circle path is fine.
      return circlePathStr;
    }

    // Event bindings
    document.getElementById('createSets').addEventListener('click', ()=>{
      const n = Number(document.getElementById('setsCount').value);
      if(Number.isNaN(n) || n < 10 || n > 10){
        alert('لطفا عددی بین ۱۰ تا ۱۰ وارد کنید (حداقل ده مجموعه، حداکثر ۱۰)');
        return;
      }
      createSets(n);
    });

    document.getElementById('resetAll').addEventListener('click', ()=>{
      if(!confirm('بازنشانی کل موارد؟')) return;
      document.getElementById('setsGrid').innerHTML='';
      setsMapClear();
      populateSelectors();
      document.getElementById('elementsList').textContent='هیچ مجموعه‌ای انتخاب نشده است';
      document.getElementById('resultMsg').innerHTML='';
    });

    document.getElementById('selectA').addEventListener('change', ()=>{ updateVennLabels(); });
    document.getElementById('selectB').addEventListener('change', ()=>{ updateVennLabels(); });
    document.getElementById('operation').addEventListener('change', ()=>{});

    document.getElementById('computeBtn').addEventListener('click', ()=>{
      // simple validation: ensure two sets selected and not same
      const a = document.getElementById('selectA').value;
      const b = document.getElementById('selectB').value;
      if(!a || !b){ alert('لطفا دو مجموعه را انتخاب کنید'); return; }
      if(a === b){ alert('لطفا دو مجموعه متفاوت انتخاب کنید'); return; }
      updateVennVisual();
    });

    document.getElementById('showAll').addEventListener('click', ()=>{
      // show all sets summary
      const summary = Object.keys(sets).map(k => `${k}: ${sets[k].join(', ') || '—'}`).join('\n');
      alert(summary || 'هیچ مجموعه‌ای ساخته نشده');
    });

    // initialize default 10 sets
    createSets(10);
  </script>
</body>
</html>
